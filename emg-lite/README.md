# EMG-lite

## 概要
EMG-lite (Expression / Motion / Gesture - lite) は、アバターの状態を表現するための内部共通規格（Internal Representation / IR）です。
特定の描画方式（Live2D, VRM, PNG, etc.）に依存せず、アバターが「どのような状態にあるか」を抽象化して定義します。

## 設計思想
- **Internal Representation**: 外部仕様ではなく内部仕様として扱います。
- **Render Agnostic**: 描画層（Adapter）がこの状態を受け取り、実際の表現（画像切り替え、モーション再生）を行います。
- **Minimal**: 複雑なボーン操作や物理演算定義は含まず、「感情」「話しているか」「睡眠」などの高レベルな状態に注目します。

## 構造
`EMGLiteState` インターフェースにより定義されます。
詳細は `types.ts` を参照してください。

## 拡張
将来的にユーザー定義のステートや、より詳細な強度パラメータを追加可能です。  
コアステートとして以下を定義します（必須以外はオプショナル扱い）。

- `emotion` (必須): 表情
- `activity` (必須): 行動・ポーズ
- `speaking` (必須): 発話真偽
- `intensity` (必須): 表現の強度ヒント
- `sleep` (任意): 睡眠/休止状態。`isSleep` スロットを優先利用
- `blinking` (任意): 瞬き状態。`eyesClosed` スロットを優先利用
- `mouthShape` (任意): 口形状/音素（`a/i/u/e/o/rest` など）。未指定時は `speaking` にフォールバック
- `overlays` (任意): 汗・傷・エフェクト等の一時オーバーレイ ID 配列（後方ほど手前に重ねる）
- `context` (任意): 実装依存メタデータ（例: 伺かサーフィス番号）を格納し、アダプタ層で解決

## スコープと推奨される使用法
EMG-Liteにおける「Status（ステート）」は、主に**表情差分や軽微なジェスチャーの変化**を表現することを想定しています。

**衣装変更（着替え）について**:
衣装の変更など、アバターの見た目が大きく変わる場合は、**別のEMGモデル（別の.emglファイル）として定義することを推奨します**。
1つのモデル定義内にすべての衣装を含めることは、ファイルサイズや管理の複雑化を招くため、仕様のスコープ外としています。

## コンテナフォーマット (.emgl)
配布・利用を容易にするため、ZIP圧縮に基づいたコンテナフォーマット `.emgl` を定義します。

### 構造
`.emgl` ファイルは以下の構造を持つZIPファイルです。

```text
filename.emgl (ZIP)
├── model.json        (必須: アバター定義ファイル。ファイル名は任意だが .json 拡張子)
├── assets/           (任意: 画像アセットなど)
│   ├── normal.png
│   └── ...
└── ...
```

### 規則
1. **JSON定義**: アーカイブ直下（ルート）にある `.json` ファイルをエントリポイントとして扱います。
    - 複数ある場合の動作は定義しません（最初の1つ、または `model.json` 優先などが推奨されます）。
2. **パス解決**: JSON内の画像パスなどは、ZIPアーカイブ内のパスとして解決します。

## 詳細ドキュメント (Specifications)
より詳細な仕様については、以下のドキュメントを参照してください。

-   **[.emgl ファイル仕様 / .emgl Specification](./tools/emg-viewer/docs/emgl_spec.md)**（`schemaVersion` による互換方針を含む）
    -   コンテナフォーマットの詳細仕様、ファイル構成、パス解決ルールなど。
-   **[モデル仕様 / Model Specification](./tools/emg-viewer/docs/model_spec.md)**
    -   `model.json` の構造、マッピングロジック（5スロットシステム）、可変スロット/オーバーレイ拡張など。
-   **[プレイヤー仕様 / Player Specification](./tools/emg-viewer/docs/player_spec.md)**
    -   EMGステート定義、デモモード、リップシンク挙動、拡張ステートのフォールバックルールなど。
